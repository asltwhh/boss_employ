{"ast":null,"code":"import \"antd-mobile/es/grid/style\";\nimport _Grid from \"antd-mobile/es/grid\";\nimport \"antd-mobile/es/input-item/style\";\nimport _InputItem from \"antd-mobile/es/input-item\";\nimport \"antd-mobile/es/nav-bar/style\";\nimport _NavBar from \"antd-mobile/es/nav-bar\";\nimport \"antd-mobile/es/icon/style\";\nimport _Icon from \"antd-mobile/es/icon\";\nimport \"antd-mobile/es/list/style\";\nimport _List from \"antd-mobile/es/list\";\nvar _jsxFileName = \"E:\\\\mycode\\\\boss_employ\\\\gzhipin-client1.0\\\\src\\\\containers\\\\chat\\\\chat.jsx\";\nimport React from \"react\";\nimport { connect } from \"react-redux\";\nimport { sendMsg } from \"../../redux/actions\";\nconst Item = _List.Item;\n\nclass Chat extends React.Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      content: \"\",\n      isShow: false //æ˜¯å¦æ˜¾ç¤ºè¡¨æƒ…åˆ—è¡¨\n\n    };\n\n    this.handleSend = () => {\n      // æ”¶é›†æ•°æ®\n      const from = this.props.user._id;\n      const to = this.props.match.params.userid;\n      const content = this.state.content.trim(); // å‘é€è¯·æ±‚(å‘æ¶ˆæ¯)\n\n      if (content) {\n        // å¼‚æ­¥æ“ä½œ\n        this.props.sendMsg({\n          from,\n          to,\n          content\n        });\n      } // æ¸…é™¤è¾“å…¥æ•°æ®\n\n\n      this.setState({\n        content: \"\"\n      });\n    };\n\n    this.toggleShow = () => {\n      const isShow = !this.state.isShow;\n      this.setState({\n        isShow\n      }); // è¿™æ˜¯ä¸ºäº†è§£å†³è¡¨æƒ…åˆ—è¡¨æ˜¾ç¤ºæ—¶çš„bug\n\n      if (isShow) {\n        // å¼‚æ­¥æ‰‹åŠ¨æ´¾å‘ä¸€ä¸ªresizeäº‹ä»¶ï¼Œè§£å†³è¡¨æƒ…åˆ—è¡¨æ˜¾ç¤ºçš„bug\n        setTimeout(() => {\n          window.dispatchEvent(new Event(\"resize\"));\n        }, 0);\n      }\n    };\n  }\n\n  componentWillMount() {\n    // åœ¨ç¬¬ä¸€æ¬¡renderä¹‹å‰è°ƒç”¨ï¼Œè¡¨ç¤ºåœ¨æ‰“å¼€å¯¹è¯æ¡†æ—¶å·²ç»åŠ è½½åˆ°äº†è¡¨æƒ…æ–‡æœ¬\n    const emojis = [\"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ™ƒ\", \"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ™ƒ\", \"ğŸ˜€\", \"ğŸ˜ƒ\", \"ğŸ˜„\", \"ğŸ˜\", \"ğŸ˜†\", \"ğŸ˜…\", \"ğŸ¤£\", \"ğŸ˜‚\", \"ğŸ™‚\", \"ğŸ™ƒ\"]; // this.emojisæ˜¯ä¸€ä¸ªå…ƒç´ ä¸ºå¯¹è±¡çš„æ•°ç»„\n\n    this.emojis = emojis.map(emoji => ({\n      text: emoji\n    }));\n  }\n\n  componentDidMount() {\n    // åˆå§‹åŒ–æ˜¾ç¤ºåˆ—è¡¨\n    window.scrollTo(0, Document.body.scrollHeight);\n  }\n\n  render() {\n    // debugger;\n    // console.log(\"æˆ‘åˆrenderäº†ä¸€æ¬¡.....\");\n    const {\n      user,\n      chat\n    } = this.props;\n    const {\n      users,\n      chatMsgs\n    } = chat; //å½“å‰chatMsgsä¸­åŒ…å«æˆ‘å’Œæ‰€æœ‰å…¶ä»–ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯ï¼Œæˆ‘ç°åœ¨åªéœ€è¦æ˜¾ç¤ºæˆ‘å’ŒæŸä¸ªç‰¹å®šç”¨æˆ·çš„èŠå¤©ä¿¡æ¯\n    // æ‰€ä»¥éœ€è¦è¿‡æ»¤\n    // å…ˆå¾—åˆ°å½“å‰çš„chat_id\n\n    const meId = user._id; // åˆšå¼€å§‹usersä¸­æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œéœ€è¦å‘é€å¼‚æ­¥è¯·æ±‚è·å–æ¶ˆæ¯åˆ—è¡¨çš„åŒæ—¶\n    // è·å–åˆ°users\n\n    if (!users[meId]) {\n      console.log(\"æˆ‘æ¸²æŸ“äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å¾—åˆ°reduxä¸­çš„çŠ¶æ€å€¼\");\n      return null;\n    } // debugger;\n\n\n    const targetId = this.props.match.params.userid;\n    const chat_id = [meId, targetId].sort().join(\"_\");\n    const msgs = chatMsgs.filter(msg => msg.chat_id === chat_id); // msgsä¸­çš„æ¶ˆæ¯æœ‰ä¸¤ç§æƒ…å†µï¼šæˆ‘å‘çš„ï¼Œå¯¹æ–¹å‘çš„\n\n    console.log(targetId); // è·å–ç›®æ ‡ç”¨æˆ·çš„å¤´åƒ\n\n    const targetHeader = users[targetId].header; // æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹æ–¹å¯èƒ½è¿˜æ²¡æœ‰å®Œå–„ä¿¡æ¯ï¼Œå¹¶ä¸å…·å¤‡icon\n\n    const targetIcon = targetHeader ? require(`../../assets/images/${targetHeader}.png`) : null;\n    return /*#__PURE__*/React.createElement(\"div\", {\n      id: \"chat-page\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 7\n      }\n    }, /*#__PURE__*/React.createElement(_NavBar, {\n      icon: /*#__PURE__*/React.createElement(_Icon, {\n        type: \"left\",\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 113,\n          columnNumber: 17\n        }\n      }),\n      onLeftClick: () => {\n        this.props.history.goBack();\n      },\n      className: \"sticky-header\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 112,\n        columnNumber: 9\n      }\n    }, users[targetId].username), /*#__PURE__*/React.createElement(_List, {\n      style: {\n        marginTop: 50,\n        marginBottom: 50\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 121,\n        columnNumber: 9\n      }\n    }, msgs.map(msg => {\n      if (msg.to === meId) {\n        // å¯¹æ–¹å‘ç»™æˆ‘çš„\n        return /*#__PURE__*/React.createElement(Item, {\n          key: msg._id,\n          thumb: targetIcon,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 17\n          }\n        }, msg.content);\n      } else {\n        //æˆ‘å‘ç»™å¯¹æ–¹çš„\n        return /*#__PURE__*/React.createElement(Item, {\n          key: msg._id,\n          extra: \"\\u6211\",\n          className: \"chat-me\",\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 133,\n            columnNumber: 17\n          }\n        }, msg.content);\n      }\n    })), /*#__PURE__*/React.createElement(\"div\", {\n      className: \"am-tab-bar\",\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 140,\n        columnNumber: 9\n      }\n    }, /*#__PURE__*/React.createElement(_InputItem, {\n      placeholder: \"\\u8BF7\\u8F93\\u5165\",\n      extra: /*#__PURE__*/React.createElement(\"span\", {\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 144,\n          columnNumber: 15\n        }\n      }, /*#__PURE__*/React.createElement(\"span\", {\n        onClick: this.toggleShow,\n        style: {\n          marginRight: 5\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 145,\n          columnNumber: 17\n        }\n      }, \"\\uD83D\\uDE03\"), /*#__PURE__*/React.createElement(\"span\", {\n        onClick: this.handleSend,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 148,\n          columnNumber: 17\n        }\n      }, \"\\u53D1\\u9001\")),\n      value: this.state.content,\n      onChange: val => this.setState({\n        content: val\n      }),\n      onFocus: () => this.setState({\n        isShow: false\n      }),\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 141,\n        columnNumber: 11\n      }\n    }), this.state.isShow ? /*#__PURE__*/React.createElement(_Grid, {\n      data: this.emojis,\n      columnNum: 8,\n      carouselMaxRow: 4,\n      isCarousel: true,\n      onClick: item => {\n        this.setState({\n          content: this.state.content + item.text\n        });\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156,\n        columnNumber: 13\n      }\n    }) : null));\n  }\n\n}\n\nexport default connect(state => ({\n  user: state.user,\n  chat: state.chat\n}), {\n  sendMsg\n})(Chat);","map":{"version":3,"sources":["E:/mycode/boss_employ/gzhipin-client1.0/src/containers/chat/chat.jsx"],"names":["React","connect","sendMsg","Item","Chat","Component","state","content","isShow","handleSend","from","props","user","_id","to","match","params","userid","trim","setState","toggleShow","setTimeout","window","dispatchEvent","Event","componentWillMount","emojis","map","emoji","text","componentDidMount","scrollTo","Document","body","scrollHeight","render","chat","users","chatMsgs","meId","console","log","targetId","chat_id","sort","join","msgs","filter","msg","targetHeader","header","targetIcon","require","history","goBack","username","marginTop","marginBottom","marginRight","val","item"],"mappings":"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","sourcesContent":["import React from \"react\";\r\nimport { connect } from \"react-redux\";\r\nimport { NavBar, List, InputItem, Grid, Icon } from \"antd-mobile\";\r\nimport { sendMsg } from \"../../redux/actions\";\r\n\r\nconst Item = List.Item;\r\n\r\nclass Chat extends React.Component {\r\n  state = {\r\n    content: \"\",\r\n    isShow: false, //æ˜¯å¦æ˜¾ç¤ºè¡¨æƒ…åˆ—è¡¨\r\n  };\r\n  componentWillMount() {\r\n    // åœ¨ç¬¬ä¸€æ¬¡renderä¹‹å‰è°ƒç”¨ï¼Œè¡¨ç¤ºåœ¨æ‰“å¼€å¯¹è¯æ¡†æ—¶å·²ç»åŠ è½½åˆ°äº†è¡¨æƒ…æ–‡æœ¬\r\n    const emojis = [\r\n      \"ğŸ˜€\",\r\n      \"ğŸ˜ƒ\",\r\n      \"ğŸ˜„\",\r\n      \"ğŸ˜\",\r\n      \"ğŸ˜†\",\r\n      \"ğŸ˜…\",\r\n      \"ğŸ¤£\",\r\n      \"ğŸ˜‚\",\r\n      \"ğŸ™‚\",\r\n      \"ğŸ™ƒ\",\r\n      \"ğŸ˜€\",\r\n      \"ğŸ˜ƒ\",\r\n      \"ğŸ˜„\",\r\n      \"ğŸ˜\",\r\n      \"ğŸ˜†\",\r\n      \"ğŸ˜…\",\r\n      \"ğŸ¤£\",\r\n      \"ğŸ˜‚\",\r\n      \"ğŸ™‚\",\r\n      \"ğŸ™ƒ\",\r\n      \"ğŸ˜€\",\r\n      \"ğŸ˜ƒ\",\r\n      \"ğŸ˜„\",\r\n      \"ğŸ˜\",\r\n      \"ğŸ˜†\",\r\n      \"ğŸ˜…\",\r\n      \"ğŸ¤£\",\r\n      \"ğŸ˜‚\",\r\n      \"ğŸ™‚\",\r\n      \"ğŸ™ƒ\",\r\n    ];\r\n    // this.emojisæ˜¯ä¸€ä¸ªå…ƒç´ ä¸ºå¯¹è±¡çš„æ•°ç»„\r\n    this.emojis = emojis.map((emoji) => ({ text: emoji }));\r\n  }\r\n  componentDidMount() {\r\n    // åˆå§‹åŒ–æ˜¾ç¤ºåˆ—è¡¨\r\n    window.scrollTo(0, Document.body.scrollHeight);\r\n  }\r\n  handleSend = () => {\r\n    // æ”¶é›†æ•°æ®\r\n    const from = this.props.user._id;\r\n    const to = this.props.match.params.userid;\r\n    const content = this.state.content.trim();\r\n    // å‘é€è¯·æ±‚(å‘æ¶ˆæ¯)\r\n    if (content) {\r\n      // å¼‚æ­¥æ“ä½œ\r\n      this.props.sendMsg({ from, to, content });\r\n    }\r\n    // æ¸…é™¤è¾“å…¥æ•°æ®\r\n    this.setState({ content: \"\" });\r\n  };\r\n  toggleShow = () => {\r\n    const isShow = !this.state.isShow;\r\n    this.setState({ isShow });\r\n    // è¿™æ˜¯ä¸ºäº†è§£å†³è¡¨æƒ…åˆ—è¡¨æ˜¾ç¤ºæ—¶çš„bug\r\n    if (isShow) {\r\n      // å¼‚æ­¥æ‰‹åŠ¨æ´¾å‘ä¸€ä¸ªresizeäº‹ä»¶ï¼Œè§£å†³è¡¨æƒ…åˆ—è¡¨æ˜¾ç¤ºçš„bug\r\n      setTimeout(() => {\r\n        window.dispatchEvent(new Event(\"resize\"));\r\n      }, 0);\r\n    }\r\n  };\r\n  render() {\r\n    // debugger;\r\n    // console.log(\"æˆ‘åˆrenderäº†ä¸€æ¬¡.....\");\r\n    const { user, chat } = this.props;\r\n    const { users, chatMsgs } = chat;\r\n    //å½“å‰chatMsgsä¸­åŒ…å«æˆ‘å’Œæ‰€æœ‰å…¶ä»–ç”¨æˆ·çš„èŠå¤©ä¿¡æ¯ï¼Œæˆ‘ç°åœ¨åªéœ€è¦æ˜¾ç¤ºæˆ‘å’ŒæŸä¸ªç‰¹å®šç”¨æˆ·çš„èŠå¤©ä¿¡æ¯\r\n    // æ‰€ä»¥éœ€è¦è¿‡æ»¤\r\n    // å…ˆå¾—åˆ°å½“å‰çš„chat_id\r\n    const meId = user._id;\r\n\r\n    // åˆšå¼€å§‹usersä¸­æ˜¯æ²¡æœ‰æ•°æ®çš„ï¼Œæ˜¯ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œéœ€è¦å‘é€å¼‚æ­¥è¯·æ±‚è·å–æ¶ˆæ¯åˆ—è¡¨çš„åŒæ—¶\r\n    // è·å–åˆ°users\r\n    if (!users[meId]) {\r\n      console.log(\"æˆ‘æ¸²æŸ“äº†ï¼Œä½†æ˜¯æˆ‘è¿˜æ²¡æœ‰å¾—åˆ°reduxä¸­çš„çŠ¶æ€å€¼\");\r\n      return null;\r\n    }\r\n\r\n    // debugger;\r\n    const targetId = this.props.match.params.userid;\r\n    const chat_id = [meId, targetId].sort().join(\"_\");\r\n\r\n    const msgs = chatMsgs.filter((msg) => msg.chat_id === chat_id);\r\n    // msgsä¸­çš„æ¶ˆæ¯æœ‰ä¸¤ç§æƒ…å†µï¼šæˆ‘å‘çš„ï¼Œå¯¹æ–¹å‘çš„\r\n\r\n    console.log(targetId);\r\n    // è·å–ç›®æ ‡ç”¨æˆ·çš„å¤´åƒ\r\n    const targetHeader = users[targetId].header;\r\n    // æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œå¯¹æ–¹å¯èƒ½è¿˜æ²¡æœ‰å®Œå–„ä¿¡æ¯ï¼Œå¹¶ä¸å…·å¤‡icon\r\n    const targetIcon = targetHeader\r\n      ? require(`../../assets/images/${targetHeader}.png`)\r\n      : null;\r\n\r\n    return (\r\n      <div id=\"chat-page\">\r\n        <NavBar\r\n          icon={<Icon type=\"left\" />}\r\n          onLeftClick={() => {\r\n            this.props.history.goBack();\r\n          }}\r\n          className=\"sticky-header\"\r\n        >\r\n          {users[targetId].username}\r\n        </NavBar>\r\n        <List style={{ marginTop: 50, marginBottom: 50 }}>\r\n          {msgs.map((msg) => {\r\n            if (msg.to === meId) {\r\n              // å¯¹æ–¹å‘ç»™æˆ‘çš„\r\n              return (\r\n                <Item key={msg._id} thumb={targetIcon}>\r\n                  {msg.content}\r\n                </Item>\r\n              );\r\n            } else {\r\n              //æˆ‘å‘ç»™å¯¹æ–¹çš„\r\n              return (\r\n                <Item key={msg._id} extra=\"æˆ‘\" className=\"chat-me\">\r\n                  {msg.content}\r\n                </Item>\r\n              );\r\n            }\r\n          })}\r\n        </List>\r\n        <div className=\"am-tab-bar\">\r\n          <InputItem\r\n            placeholder=\"è¯·è¾“å…¥\"\r\n            extra={\r\n              <span>\r\n                <span onClick={this.toggleShow} style={{ marginRight: 5 }}>\r\n                  ğŸ˜ƒ\r\n                </span>\r\n                <span onClick={this.handleSend}>å‘é€</span>\r\n              </span>\r\n            }\r\n            value={this.state.content}\r\n            onChange={(val) => this.setState({ content: val })}\r\n            onFocus={() => this.setState({ isShow: false })}\r\n          ></InputItem>\r\n          {this.state.isShow ? (\r\n            <Grid\r\n              data={this.emojis}\r\n              columnNum={8}\r\n              carouselMaxRow={4}\r\n              isCarousel={true}\r\n              onClick={(item) => {\r\n                this.setState({ content: this.state.content + item.text });\r\n              }}\r\n            />\r\n          ) : null}\r\n        </div>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nexport default connect((state) => ({ user: state.user, chat: state.chat }), {\r\n  sendMsg,\r\n})(Chat);\r\n"]},"metadata":{},"sourceType":"module"}